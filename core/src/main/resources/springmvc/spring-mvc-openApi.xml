<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:c="http://www.springframework.org/schema/c"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd">

	<description>openApi的核心配置 依赖于spring-mvc-messageConverters.xml、spring-mvc-jsonp.xml
	其中包含mvc:annotation-driven 注意避免重复定义</description>
	
	<bean id="apiRequestMappingHandlerMapping" class="cn.meteor.module.core.openApi.annotation.ApiMethodHandlerMapping" lazy-init="false"><!-- 提供支持ApiMethod自定义Mapping注解 -->
		<property name="order"  value="-2" />
		<property name="contentNegotiationManager" ref="contentNegotiationManager" />
		<property name="useHandler"  value="${core.openApi.apiRequestMappingHandlerMapping.useHandler:false}" /><!-- 是否通过xml的handler映射方法 -->
	</bean>
	
	<bean id="contentNegotiationManager"  class="org.springframework.web.accept.ContentNegotiationManagerFactoryBean"><!-- 提供支持通过format控制json或xml响应 -->
		<property name="favorPathExtension" value="false" />
		<property name="favorParameter" value="true" />
		<property name="parameterName" value="format" />
		<property name="ignoreAcceptHeader" value="${core.openApi.contentNegotiationManager.ignoreAcceptHeader:false}"></property>
		<property name="useJaf" value="false"/>
		<property name="defaultContentType" value="application/json" />
		<property name="mediaTypes">
            <map>
				<entry key="json" value="application/json;charset=UTF-8" />
				<entry key="xml" value="application/xml; charset=UTF-8" />
				<entry key="htm" value="text/htm" />
				<!-- <entry key="file" value="application/octet-stream" />
				<entry key="image" value="image/*" /> -->
			</map>
        </property>
	</bean>
	
	<!-- <mvc:annotation-driven /> -->
	<mvc:annotation-driven validator="validator"><!--   content-negotiation-manager="contentNegotiationManager"  -->
		<!-- <mvc:message-converters register-defaults="true" >
			<ref bean="mappingJackson2HttpMessageConverter" />
	        <ref bean="mappingJackson2XmlHttpMessageConverter" />
		</mvc:message-converters> -->
		<!-- <mvc:message-converters register-defaults="true">
            <ref bean="stringHttpMessageConverter" />
        	<ref bean="mappingJackson2HttpMessageConverter" />
        	<ref bean="mappingJackson2XmlHttpMessageConverter" />
  		</mvc:message-converters> -->
  		<mvc:argument-resolvers>
  			<bean class="cn.meteor.module.core.openApi.handler.RestRequestResponseBodyMethodProcessor"><!-- 提供支持RestRequestBody注解 -->
            	<constructor-arg ref="messageConverters" />
            	<constructor-arg ref="requestResponseBodyAdvice" /><!-- jsonp -->
            </bean>
  		</mvc:argument-resolvers>
  		 <mvc:return-value-handlers>
  		 
            <!-- <bean class="org.springframework.web.servlet.mvc.method.annotation.ModelAndViewMethodReturnValueHandler"></bean> -->
            <!-- <bean class="org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor"></bean> -->
            <bean class="cn.meteor.module.core.openApi.handler.RestRequestResponseBodyMethodProcessor"><!-- 提供支持RestResponseBody注解 -->
            	<constructor-arg ref="messageConverters" />
            	<constructor-arg ref="requestResponseBodyAdvice" /><!-- jsonp -->
            </bean>
        </mvc:return-value-handlers>
	</mvc:annotation-driven>	
	
</beans>
